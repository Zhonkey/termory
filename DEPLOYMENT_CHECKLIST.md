# Production Deployment Checklist

Используйте этот чек-лист перед развертыванием приложения в production.

## Pre-Deployment

### Код и версионирование
- [ ] Все изменения закоммичены в git
- [ ] Создан git tag для версии: `git tag -a v1.0.0 -m "Release v1.0.0"`
- [ ] Все тесты пройдены: `go test ./...`
- [ ] Код проверен линтером: `golangci-lint run`
- [ ] Нет TODO или FIXME комментариев в критичном коде

### Конфигурация
- [ ] Скопирован `.env.production.example` в `.env.production`
- [ ] Заполнены все переменные окружения в `.env.production`
- [ ] Пароли БД изменены на безопасные
- [ ] JWT секреты изменены на новые
- [ ] CORS origins настроены правильно
- [ ] Логирование настроено на production уровень

### База данных
- [ ] Все миграции написаны и протестированы
- [ ] Миграции протестированы на staging
- [ ] Есть план отката миграций
- [ ] Сделан бэкап текущей БД (если обновление)
- [ ] Проверена совместимость миграций с текущей версией

### Docker образы
- [ ] Dockerfile.prod проверен и оптимизирован
- [ ] Образ собран локально и протестирован
- [ ] Размер образа приемлем (~50MB)
- [ ] Нет чувствительных данных в образе
- [ ] Healthcheck работает корректно

### Безопасность
- [ ] Используется непривилегированный пользователь в контейнере
- [ ] Все зависимости обновлены: `go mod tidy`
- [ ] Проверены уязвимости: `go list -json -m all | nancy sleuth`
- [ ] HTTPS настроен (если требуется)
- [ ] Firewall правила настроены
- [ ] SSH ключи настроены для доступа к серверу

### Мониторинг и логирование
- [ ] Настроено логирование в файлы или сервис
- [ ] Настроены алерты для критичных ошибок
- [ ] Есть способ просмотра логов в production
- [ ] Настроены метрики (если требуется)
- [ ] Есть способ мониторить здоровье приложения

## Deployment

### Подготовка сервера
- [ ] Сервер доступен и готов
- [ ] Docker и Docker Compose установлены
- [ ] Достаточно дискового пространства
- [ ] Сетевые порты открыты (8080 для API, 5432 для БД)
- [ ] Переменные окружения установлены на сервере

### Развертывание
- [ ] Скопированы все необходимые файлы на сервер:
  - [ ] `docker-compose.prod.yml`
  - [ ] `Dockerfile.prod`
  - [ ] `cmd/migrate/migrations/`
  - [ ] `.env.production`
- [ ] Выполнена сборка образа: `make build-prod`
- [ ] Запущены контейнеры: `make up-prod`
- [ ] Выполнены миграции: `make migrate-prod`
- [ ] Приложение доступно на http://localhost:8080

### Проверка после развертывания
- [ ] API отвечает на запросы
- [ ] Healthcheck проходит успешно
- [ ] БД подключена и работает
- [ ] Миграции выполнены успешно
- [ ] Логи не содержат ошибок
- [ ] Все endpoints работают корректно

## Post-Deployment

### Мониторинг
- [ ] Проверены логи за последний час
- [ ] Нет критичных ошибок в логах
- [ ] Приложение использует приемлемое количество памяти
- [ ] CPU нагрузка в норме
- [ ] Дисковое пространство не заканчивается

### Функциональное тестирование
- [ ] Протестированы основные endpoints
- [ ] Протестирована аутентификация
- [ ] Протестирована работа с БД
- [ ] Протестированы критичные бизнес-процессы
- [ ] Нет регрессий в функциональности

### Документирование
- [ ] Обновлена документация развертывания
- [ ] Записаны все изменения конфигурации
- [ ] Создана запись о развертывании (дата, версия, изменения)
- [ ] Обновлены инструкции для отката

## Rollback Plan

### Если что-то пошло не так
- [ ] Остановить контейнеры: `./scripts/deploy.sh down`
- [ ] Откатить миграции: `./scripts/deploy.sh migrate-down`
- [ ] Переключиться на предыдущую версию: `git checkout <previous-tag>`
- [ ] Пересобрать образ: `make build-prod`
- [ ] Запустить предыдущую версию: `./scripts/deploy.sh up`
- [ ] Проверить логи и функциональность

## Команды для быстрого доступа

```bash
# Полный деплой
make deploy-prod

# Просмотр логов
make logs-prod
make logs-db-prod

# Проверка здоровья
./scripts/deploy.sh health

# Откат
./scripts/deploy.sh down
./scripts/deploy.sh migrate-down

# Подключение к БД
docker-compose -f docker-compose.prod.yml exec db psql -U trainer -d trainer
```

## Контакты и эскалация

- **DevOps**: [контакт]
- **DBA**: [контакт]
- **Архитектор**: [контакт]
- **On-call**: [контакт]

## Дополнительные ресурсы

- [PRODUCTION_GUIDE.md](./PRODUCTION_GUIDE.md) - Полное руководство по развертыванию
- [Makefile](./Makefile) - Доступные команды
- [scripts/deploy.sh](./scripts/deploy.sh) - Скрипт развертывания
